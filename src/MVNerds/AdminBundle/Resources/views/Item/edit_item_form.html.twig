{% extends 'MVNerdsAdminBundle:Item:layout.html.twig' %}

{% block title %}Administration des items - MVNerds{% endblock %}

{% block content %}
	<h1>Editer un item</h1>

	<div class="action-buttons">
		<a href="{{ path('admin_items_index') }}" class="btn"><i class="icon-arrow-left"></i> <strong>Retourner à la liste</strong></a>
		<a href="#" class="btn btn-success btn-large pull-right btn-submit-form"><i class="icon-ok icon-white"></i> <strong>J'ai terminé</strong></a>
		<a href="{{ path('admin_items_index') }}" class="btn pull-right btn-danger"><strong>Annuler</strong></a>
	</div>

	<div class="content-container">
		<form action="{{ path('admin_items_edit', {'slug': item.getSlug()}) }}" method="POST" {{ form_enctype(form) }}>
			<div>
				<label>Idenfiant</label> {{ item.getId() }}
			</div>
			
			<fieldset>
				<legend>Traductions : </legend>
				{{ form_widget(form.item_i18ns) }}		
			</fieldset>
				
			<fieldset>
				<legend>Propriétés : </legend>
				<div class="row-fluid">
					<div class="span6">
						{{ form_label(form.cost) }}
					</div>
					<div class="span6">
						{{ form_widget(form.cost) }}
					</div>
				</div>
				<div class="row-fluid">
					<div class="span6">
						{{ form_label(form.sell_value) }}
					</div>
					<div class="span6">
						{{ form_widget(form.sell_value) }}
					</div>
				</div>
				<div class="row-fluid">
					<div class="span6">
						{{ form_label(form.riot_code) }}
					</div>
					<div class="span6">
						{{ form_widget(form.riot_code) }}
					</div>
				</div>
				<div class="row-fluid">
					<div class="span6">
						{{ form_label(form.stacks) }}
					</div>
					<div class="span6">
						{{ form_widget(form.stacks) }}
					</div>
				</div>
			</fieldset>
				
			<fieldset>
				<legend>Modes de jeu : </legend>
				{{ form_widget(form.item_game_modes) }}
			</fieldset>
				
			<fieldset>
				<legend>Effets primaires : </legend>	
				{{ form_widget(form.item_primary_effects) }}	
			</fieldset>
				
			<fieldset>
				<legend>Effets secondaires : </legend>	
				{{ form_widget(form.item_secondary_effects) }}	
			</fieldset>
				
			<fieldset>
				<legend>Généalogie : </legend>	
				{{ form_widget(form.item_geneologies_related_by_child_id) }}	
			</fieldset>
				
			<fieldset>
				<legend>Tags : </legend>	
				{{ form_widget(form.item_tags) }}	
			</fieldset>
				
			<input type="submit" class="submit-form hide" />
		</form>
	</div>
	
	<script type="text/javascript">
		
		
		// Get the div that holds the collection of tags
		var tagCollectionHolder = $('div#item_item_tags');
		var gameModeCollectionHolder = $('div#item_item_game_modes');
		var primaryEffectCollectionHolder = $('div#item_item_primary_effects');
		var geneologyCollectionHolder = $('div#item_item_geneologies_related_by_child_id');
		var i18nCollectionHolder = $('div#item_item_i18ns');

		// setup an "add a tag" link
		var $addTagLink = $('<a href="#" class="btn btn-success" id="add-tag-link"><i class="icon-white icon-plus-sign"></i> Add a tag</a>');
		var $addGameModeLink = $('<a href="#" class="btn btn-success" id="add-game-mode-link"><i class="icon-white icon-plus-sign"></i> Add a game mode</a>');
		var $addPrimaryEffectLink = $('<a href="#" class="btn btn-success" id="add-primary-effect-link"><i class="icon-white icon-plus-sign"></i> Add a primary effect</a>');
		var $addGeneologyLink = $('<a href="#" class="btn btn-success" id="add-geneology-link"><i class="icon-white icon-plus-sign"></i> Add a child</a>');
		var $addI18nLink = $('<a href="#" class="btn btn-success" id="add-i18n-link"><i class="icon-white icon-plus-sign"></i> Add a translation</a>');
		
		jQuery(document).ready(function() {
			tagCollectionHolder.before($addTagLink);
			gameModeCollectionHolder.before($addGameModeLink);
			primaryEffectCollectionHolder.before($addPrimaryEffectLink);
			geneologyCollectionHolder.before($addGeneologyLink);
			i18nCollectionHolder.before($addI18nLink);

			$addTagLink.on('click', function(e) {
				e.preventDefault();
				addForm(tagCollectionHolder, $addTagLink, true);
			});
			$addGameModeLink.on('click', function(e) {
				e.preventDefault();
				addForm(gameModeCollectionHolder, $addGameModeLink, true);
			});
			$addPrimaryEffectLink.on('click', function(e) {
				e.preventDefault();
				addForm(primaryEffectCollectionHolder, $addPrimaryEffectLink, true);
			});
			$addGeneologyLink.on('click', function(e) {
				e.preventDefault();
				addForm(geneologyCollectionHolder, $addGeneologyLink, true);
			});
			$addI18nLink.on('click', function(e) {
				e.preventDefault();
				addForm(i18nCollectionHolder, $addI18nLink);
			});
			
			tagCollectionHolder.children('div').each(function() {
				addFormDeleteLink($(this));
			});
			gameModeCollectionHolder.children('div').each(function() {
				addFormDeleteLink($(this));
			});
			primaryEffectCollectionHolder.children('div').each(function() {
				addFormDeleteLink($(this));
			});
			geneologyCollectionHolder.children('div').each(function() {
				addFormDeleteLink($(this));
			});
			i18nCollectionHolder.children('div').each(function() {
				addFormDeleteLink($(this));
			});
		});
		
		function addForm(collectionHolder, $link, enableDelete) {
			var prototype = collectionHolder.attr('data-prototype');
			var collectionSize = collectionHolder.children().length;
			var newForm = prototype.replace(/__name__label__/g, collectionSize);
			collectionHolder.append($(newForm));
			if(enableDelete != undefined && enableDelete) {
				addFormDeleteLink(collectionHolder.find('div').last().parent().parent());
			}
		}
		function addFormDeleteLink($formDiv) {
			var $removeFormA = $('<a style="margin-left:10px;" class="btn btn-small btn-danger" href="#"><i class="icon-remove icon-white"></i></a>');
			$formDiv.children('div').find('div').last().append($removeFormA);

			$removeFormA.on('click', function(e) {
				e.preventDefault();
				$formDiv.remove();
			});
		}
	</script>
{% endblock %}